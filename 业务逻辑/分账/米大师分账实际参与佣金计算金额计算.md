# 关键结论

**使用 \($$A = \frac{M \times C_2}{C_1}$$ 
) 推导出的金额 \( A \)，满足 \($$ \text{floor}(A \times r) = C_2$$ \)。**

---

## 数学证明

### 1. 原始公式

已知：
$$
C_1 = \text{floor}(M \times r)
$$
其中：
- \( M \) 是原始金额，
- \( r \) 是比例，
- \( C_1 \) 是预期佣金。

### 2. 推导实际金额 \( A \)

通过反向推导：
$$
A = \frac{M \times C_2}{C_1}
$$
目标是使 \( $$\text{floor}(A \times r) = C_2$$ \)。

### 3. 验证 \( $$\text{floor}(A \times r) $$\) 的必然性

将 \( A \) 代入计算：
$$
A \times r = \left( \frac{M \times C_2}{C_1} \right) \times r = \frac{M \times r \times C_2}{C_1}
$$
由于 \($$ M \times r \in [C_1, C_1 + 1) $$\)，可以表示为：
$$
M \times r = C_1 + \delta \quad (0 \leq \delta < 1)
$$
代入后：
$$
A \times r = \frac{(C_1 + \delta) \times C_2}{C_1} = C_2 + \frac{\delta \times C_2}{C_1}
$$
由于 \( \delta < 1 \) 且 \( C_2 \leq C_1 \)（佣金不可能超过原始预期），有：
$$
0 \leq \frac{\delta \times C_2}{C_1} < 1
$$
因此：
$$
\text{floor}(A \times r) = C_2
$$

---

## 示例验证

以案例为例：
- \( M = 308 \), \( r = 12\% \), \( C_1 = 36 \), \( C_2 = 19 \)
- 推导 \( $$A = \frac{308 \times 19}{36} \approx 162.5556 $$\)
- 计算 \($$ A \times r = 162.5556 \times 0.12 \approx 19.5067 $$)
- \( $$\text{floor}(19.5067) = 19 $$ \)，符合预期。

---

## 边界条件与注意事项

### 1. 前提条件
- \( $$C_1 = \text{floor}(M \times r)$$ \) 必须严格成立，否则推导失效。
- \( $$C_2 \leq C_1 $$\)，否则 \( $$A \times r $$\) 可能超出范围。

### 2. 浮点数精度风险
- 实际编程中需注意浮点数精度误差（如 `double` 类型可能因精度丢失导致误差）。
- **解决方法**：使用高精度计算库（如 `BigDecimal`）或保留足够小数位。

### 3. 极端情况测试
- **案例1**：\( M = 100.999 \), \( r = 0.1 \), \( C_1 = 10 \), \( C_2 = 9 \)  
  \( $$A = \frac{100.999 \times 9}{10} \approx 90.8991 $$\), \( $$A \times r = 9.08991 $$\), \($$ \text{floor}(9.08991) = 9 $$\)。
- **案例2**：\( C_2 = C_1 \)，直接得到 \( A = M \)，结果与原式一致。

---

## 总结

- **方法有效性**：数学上严格成立，\( $$\text{floor}(A \times r) = C_2$$ \) 必然成立。
- **工程实践**：需注意浮点数精度问题，建议使用高