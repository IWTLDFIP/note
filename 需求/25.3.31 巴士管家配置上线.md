- test: http://192002754:79893/gw/pay/midas/callback/basicpay
-  prod: http://192002753:79894/gw/pay/midas/callback/basicpay




```

1707699585
sub_offer_id: "1450345135"
sub_res_offer_id: "8002211697"

创建道具
PRO-4ONI6REBLHDF
发布道具
查询道具
查询回调接口
创建回调接口
创建分区
"zoneId": "8002211697basicpayl5prod",
"zoneName": "8002211697-basic-pay-l5-prod"
查询分区
发布分区
```

trpc_go.yaml
``` yaml
global: #全局配置

namespace: Production # 环境类型，分正式 production 和非正式 development 两种类型

env_name: prod # 环境名称，非正式环境下多环境的名称

container_name: ${TKEX_CLUSTER}-${zone_city}-${POD_NAME} #容器名称

local_ip: ${POD_IP} #本地IP，容器内为容器ip，物理机或虚拟机为本机ip

admin_port: 12000 #管理命令服务端口

full_set_name: ${set_name}

enable_set: ${enable_set}

conf_provider: file #路由、插件等配置存储方式， 支持file, rainbow

  

server: #服务端配置

app: TradingCenter # 业务的应用名

server: MidasServer # 进程服务名

bin_path: /usr/local/trpc/bin/ # 二进制可执行文件和框架配置文件所在路径

conf_path: /usr/local/trpc/conf/ # 业务配置文件所在路径

data_path: /usr/local/trpc/data/ # 业务数据文件所在路径

filter: # 针对所有 service 处理函数前后的拦截器列表

- simpledebuglog

- recovery # 拦截框架创建的业务处理协程 panic

- cm

- opentelemetry

- galileo

admin:

ip: ${POD_IP} #ip

port: 12000 #

read_timeout: 3000 #ms. 请求被接受到请求信息被完全读取的超时时间设置，防止慢客户端

write_timeout: 60000 #ms. 处理的超时时间

service: #业务服务提供的 service，可以有多个

- name: trpc.TradingCenter.PaymentChannel.MidasBasicPay #service的路由名称

port: 8080 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasPayScore #service的路由名称

port: 8081 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasRefund #service的路由名称

port: 8082 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasCallback #service的路由名称

port: 8083 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: http #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasProfitSharing #service的路由名称

port: 8084 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasSubMerchant #service的路由名称

port: 8005 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 10000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasQuery #service的路由名称

port: 8006 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasSubsidies #service的路由名称

port: 8007 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasAdmin #service的路由名称

port: 8008 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasPayScoreContract #service的路由名称

port: 8009 #服务监听端口 可使用占位符 ${port}

network: tcp #网络监听类型 tcp udp

protocol: trpc #应用层协议 trpc http

timeout: 7000 #请求最长处理时间 单位 毫秒

- name: trpc.TradingCenter.PaymentChannel.MidasConsumer

address: midasConsumer

protocol: tdmq

  

client: #客户端调用的后端配置

timeout: 1000 # 针对所有后端的请求最长处理时间

namespace: Production # 针对所有后端的环境

filter: # 针对所有后端调用函数前后的拦截器列表

- cm

- opentelemetry

- galileo

service: # 针对单个后端的配置

- name: trpc.Redis.TradeGateway.Public

target: redis://:ZEZ5VmkPNB92Yb@11.150.236.99:6379/2

timeout: 8000

- name: trpc.http.Midas.MerchantService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

# target: polaris://midasweb-release

target: dns://midasweb-release.production.polaris

protocol: http

timeout: 10000

- name: trpc.http.Midas.BasicPayService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://64264129:1769472

protocol: http

timeout: 5000

- name: trpc.http.Midas.PayScoreService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://64056897:1703936

protocol: http

timeout: 5000

- name: trpc.http.Midas.PayScoreBackendService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://64056897:1703936

protocol: http

timeout: 5000

- name: trpc.http.Midas.PayScoreSyncService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://192002625:695229

protocol: http

timeout: 5000

- name: trpc.http.Midas.ProfitSharingService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://Jecker

protocol: http

timeout: 5000

- name: trpc.http.Midas.RefundService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://64264129:1769472

protocol: http

timeout: 5000

- name: trpc.http.Midas.SubsidiesService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://64264129:1769472

protocol: http

timeout: 5000

- name: trpc.http.Midas.AdminService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://midasweb-release

# target: dns://midasweb-release.production.polaris

protocol: http

timeout: 5000

- name: trpc.Trade.WorkSpaceServer.AdminService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://trpc.Trade.WorkSpaceServer.AdminService

protocol: http

timeout: 5000

- name: trpc.Trade.PaymentCenter.PaymentCallbackServiceV1

callee: trpc.Trade.PaymentCenter.PaymentCallbackService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://trpc.Trade.PaymentCenter.PaymentCallbackService

protocol: trpc

timeout: 5000

- name: trpc.Trade.PaymentCenter.PaymentCallbackServiceV2

callee: trpc.Trade.PaymentCenter.PaymentCallbackService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://trpc.Trade.PaymentCenter.PaymentCallbackServiceV2

protocol: trpc

timeout: 5000

- name: trpc.Trade.PaymentSettlementCenter.ProfitSharingOperateService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://trpc.Trade.PaymentSettlementCenter.ProfitSharingOperateService

protocol: trpc

timeout: 5000

- name: trpc.http.Midas.PayScoreContract

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://192002625:774113

protocol: http

timeout: 5000

- name: trpc.TradingCenter.PaymentChannel.MidasProducer

target: tdmq://midasProducer

- name: trpc.Trade.PaymentSigningCenter.PayScoreSigningWxCallbackService

network: tcp

disable_servicerouter: true

namespace: Production # 后端服务环境

target: polaris://trpc.Trade.PaymentSigningCenter.PayScoreSigningWxCallbackService

protocol: trpc

timeout: 5000

- name: trpc.mysql.takecar.paymentservice

target: dsn://cx_payment_auth_read:cx_payment_auth_read#sinan123@tcp(11.168.177.3:3306)/payment_service?charset=utf8&parseTime=True&loc=Local

plugins: #插件配置

log: # 日志配置

default: # 默认日志的配置，可支持多输出

- writer: file # 本地文件日志

level: debug # 本地文件滚动日志的级别

writer_config:

filename: /usr/local/trpc/log/trpc.log # 本地文件滚动日志存放的路径

max_size: 10 # 本地文件滚动日志的大小 单位 MB

max_backups: 10 # 最大日志文件数

max_age: 7 # 最大日志保留天数

compress: false # 日志文件是否压缩

mq:

tdmq:

servers: # Consumer

- name: midasConsumer

url: http://pulsar-25wdeqo33vra.sap-51qsghfq.tdmq-pulsar.ap-sh.internal.tencenttdmq.com:8080

connection_timeout: 1s

topic: pulsar-25wdeqo33vra/midas/midas-refund-notify

consumer_name: midas-refund-notify-subscribe

subscription_name: midas-refund-notify-subscribe

subscription_type: shared

initial_position: latest

max_cocurrent: 100

auth_name: token

auth_params: >-

{"token": "eyJrZXlJZCI6InB1bHNhci0yNXdkZXFvMzN2cmEiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJwdWxzYXItMjV3ZGVxbzMzdnJhX01pZGFzU2VydmVyIn0.XqyOWWSj07MdFoyJvoiWa2oK5vftRdwVT451C_1ECUs"}

rate_limit:

token_per_second: 100

burst: 200

dlq_policy_topic: pulsar-25wdeqo33vra/midas/midas-refund-notify-midas-refund-notify-subscribe-DLQ

dlq_policy_max_deliveries: 10

enable_retry: 1

nack_backoff_policy: [1m, 5m, 10m, 30m, 1h, 6h, 24h, 72h]

clients: # Producer

- name: midasProducer

url: http://pulsar-25wdeqo33vra.sap-51qsghfq.tdmq-pulsar.ap-sh.internal.tencenttdmq.com:8080

# connection_timeout: 5s

topic: pulsar-25wdeqo33vra/midas/midas-refund-notify

auth_name: token

auth_params: >-

{"token": "eyJrZXlJZCI6InB1bHNhci0yNXdkZXFvMzN2cmEiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJwdWxzYXItMjV3ZGVxbzMzdnJhX01pZGFzU2VydmVyIn0.XqyOWWSj07MdFoyJvoiWa2oK5vftRdwVT451C_1ECUs"}

deliver_after: 120s

selector:

polaris:

protocol: grpc #北极星交互协议支持 http，grpc，trpc

discovery:

refresh_interval: 10000 # 北极星服务发现刷新间隔，123默认10000，即10s

metrics:

cm: #cloud monitor

app: TradingCenter

service: MidasServer

zhiyan:

#全局的appMark，下面各个场景(aModAppMark,pModAppMark,attrAppMark,defaultCustomAppMark)的appMark为空时使用该值替换，避免重复填写相同的appMark [可选，新版agent也支持通过]

appMark: 10329_TradingCenterAppMark

#自定义的主调上报appMark[可选，默认为空，即使用appMark替换]

#数据上报的智研监控环境。[可选，未配置为空，会上报值默认的生产环境]

env: "prod-base"

#智研上报sdk的配置[可选，如果不配置这个选项的话，那么默认使用下面的默认值]，详细情况请查看https://git.code.oa.com/zhiyan-monitor/sdk/go-sdk/tree/master

agentConfig:

#智研agent的相关配置

agent:

#智研agent的配置文件[可选，默认为/usr/local/zhiyan/agent/etc/agent.yaml，使用容器agent的时候应该改为/data/zhiyan/agent/etc/agent.yaml]

agent_config_file: /data/zhiyan/agent/etc/agent.yaml

#智研agent监听的unix socket[可选，默认为/usr/local/zhiyan/agent/bin/agent_socket，使用容器agent的时候应该改为/data/zhiyan/agent/bin/agent_socket]

agent_socket_path: /data/zhiyan/agent/bin/agent_socket

agent_config_socket_path: /data/zhiyan/agent/bin/agent_socket2

#上报字符串告警的使用的agent监听的Unix socket，使用容器agent的时候应该改为/data/zhiyan/agent/plugins/plugin_socket

agent_string_socket_path: /data/zhiyan/agent/plugins/plugin_socket

telemetry: # 注意缩进层级关系

opentelemetry:

tenant_id: 3280#apm-log-gbgceeaaaga7g5ce#10329_86407___apm

addr: otel-collect-proxy.zhiyan.tencent-cloud.net:4317 # 集群地址

# addr: trace.zhiyan.tencent-cloud.net:4317 # 集群地址

metrics:

enabled: false

sampler:

fraction: 1 # 万分之一采样（0.0001代表每10000请求上报一次trace数据,同理0.01为每100 上报一次trace数据, 如果需要100%采样，修改为1,强烈建议配置采用率）

logs:

enabled: true # 远程日志开关，默认关闭

level: "info" # 日志级别，默认error

enable_sampler: false # 是否启用采样器, 启用后只有当前请求命中采样时才会上报独立日志（需要平台支持染色采样接口，部分平台可能不支持请咨询平台方）

# trace_log(follow log)模式, 枚举值可选:verbose/disable

# verbose:以DEBUG级别打印flow log包括接口名、请求、响应、耗时, disable:不打印, 默认不打印

trace_log_mode: "verbose"

disable_recovery: false # log filter默认会recovery panic并打印日志上报指标

traces:

disable_trace_body: false # trace对req和rsp的上报开关, true:关闭上报以提升性能, false:上报, 默认上报

enable_deferred_sample: false # 是否开启延迟采样 在span结束后的导出采样, 额外上报出错的/高耗时的. 默认: disable

deferred_sample_error: true # 采样出错的

deferred_sample_slow_duration: 500ms # 采样耗时大于指定值的

disable_parent_sampling: false # 默认 false, 开启后将不使用上游的采样结果

galileo:

verbose: error # 伽利略自身的诊断日志级别，取值范围：debug, info, error, none，日志输出在 ./galileo/galileo.log 中。

config: #配置

metrics_config: # 指标配置

enable: true # 是否启用指标

traces_config: # 追踪配置

enable: true # 是否启用追踪，默认 true。如果设置为 false，会中断 trace，让上游的调用链不完整。v0.3.7 以上生效。

processor: # 追踪数据处理相关配置

sampler: # 采样器配置

fraction: 0.0001 # 采样比例，默认 0。（v0.11.0)

error_fraction: 1

enable_min_sample: true # 启用每分钟每接口最少 1 个请求采样，默认 true (v0.11.0)。

enable_dyeing: true # 开启染色采样，默认 true。

disable_trace_body: false # 若为 true，则关闭 trace 中对 req 和 rsp 的 body 上报，可以大幅提高上报性能。默认 true。

enable_deferred_sample: false # 开启延迟采样（请求处理完采样），默认 false。0.3.0 以上生效。

deferred_sample_error: false # 开启延迟采样出错采样（请求处理完出现错误采样），默认 false。0.3.0 以上生效。

deferred_sample_slow_duration_ms: 1000 # 慢操作阈值（请求耗时超过该值采样），单位 ms，默认 1000。0.3.0 以上生效。

disable_parent_sampling: false # 忽略上游的采样结果，默认 false。v0.3.7 以上生效。

logs_config: # 日志配置

enable: true # 是否启用日志

processor: # 日志数据处理相关配置

only_trace_log: false # 是否只上报命中 trace 的 log，默认关闭

must_log_traced: false # 是否命中 traced 不管任何级别日志都上报，默认关闭。v0.3.22 以上生效，详细参考 「2.2.3.2 命中采样突破日志级别」

trace_log_mode: 0 # debug 访问日志 (access_log) 打印模式，0不打印， 1：单行打印，3：多行打印，2：不打印，默认 0

level: debug # 上报到远程的日志级别，默认 error

enable_recovery: true # 是否捕获 panic，默认 true

profiles_config: # profile配置

enable: true # 是否启用 profile

processor: # profile 数据处理相关配置

profile_types: ["cpu", "heap"] # 采集 profile 的类型，支持 cpu、heap、mutex、block、goroutine，默认开启 cpu 和 heap。

version: 1 # 版本号，默认 0，此版本号用于控制远程配置和本地配置的优先级，版本号高的优先，一般设置成 1 即可。

resource: # resource 资源信息，在 SDK 运行期间不会改变。resource 中的字段一般不需要配置，默认会填充。

platform: STKE # 服务部署的平台，如 PCG-123, STKE, 默认 PCG-123



```